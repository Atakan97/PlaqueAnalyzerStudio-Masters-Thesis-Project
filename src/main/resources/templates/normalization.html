<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Normalization Tool</title>
  <link rel="stylesheet" th:href="@{/css/style.css}" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  <script th:inline="javascript">
    /*<![CDATA[*/
    window.originalTable   = /*[[${initialCalcTableJson}]]*/ [];
    window.ricMatrixTable  = /*[[${ricJson}]]*/ [];
    window.currentRelationsManual = /*[[${currentRelationsManualJson}]]*/ [];
    window.currentRelationsColumns = /*[[${currentRelationsColumnsJson}]]*/ [];
    window.currentRelationsFds = /*[[${currentRelationsFdsJson}]]*/ [];
    window.currentRelationsFdsOriginal = /*[[${currentRelationsFdsOriginalJson}]]*/ [];
    window.currentRelationsRic = /*[[${currentRelationsRicJson}]]*/ [];
    window.currentUnionCols = /*[[${currentUnionColsJson}]]*/ [];
    window.currentGlobalManualRows = /*[[${currentGlobalManualRowsJson}]]*/ [];
    window.currentGlobalRic = /*[[${currentGlobalRicJson}]]*/ [];
    window.normalizationStartTimeMs = /*[[${normalizationStartTimeMs}]]*/ null;
    /*]]>*/
  </script>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script defer th:src="@{/js/normalize.js}"></script>
</head>
<body>
<div class="normalization-container">

  <div class="norm-header">
    <h2 class="section-heading-sm">Normalization Assistant</h2>
    <div class="norm-header-actions">
      <a th:if="${canReturn}" th:href="@{/normalize/previous}" class="button pill return-previous-btn">
        ← Return to Previous Step
      </a>
      <a th:href="@{/calc-results}" class="button pill return-results-btn">← Return to Calculation Results</a>
    </div>
  </div>

  <div class="main-normalization-flex">

    <div class="original-table-wrapper">

      <div id="fdListContainer" th:if="${fdItems.size()} > 0" class="fd-inline-panel">

        <button id="showClosureNormBtn"
                class="small"
                style="margin-bottom: 10px;">Show Transitive Closure FDs</button>

        <h4>Functional Dependencies</h4>
        <ul id="fdListUl" class="fd-pill-list">
          <li th:each="fd : ${fdItems}"
              th:text="${fd}"
              th:classappend="${fdInferred.contains(fd)} ? 'inferred' : ''">
          </li>
        </ul>
      </div>
      <h3 class="section-subheading">Original Table</h3>

      <div id="originalTableContainer"></div>
      <div class="original-table-controls">
        <button id="originalShowRicBtn" type="button" class="small" style="display:none">Show Information Contents</button>
        <button id="originalReturnBtn" type="button" class="small" style="display:none">Return to Input</button>
      </div>
    </div>

  </div>

  <div class="orig-with-add">
    <div class="global-actions">
      <button id="addTable" class="button pill">+ Add Decomposed Table</button>

      <button type="button" id="decompositionFinishedBtn" class="button pill">Decomposition Finished</button>
      <button type="button" id="changeDecompositionBtn" class="button pill" style="display:none">Change Decomposition</button>

    </div>
  </div>

  <div id="decomposedRelationsContainer"></div>

  <div id="decomposedTablesContainer" style="display:none"></div>

  <div id="dpLjStatusBox" style="display:none; margin:18px 0; padding:12px; border-radius:6px; background:#fbfbfb; border:1px solid #ddd;">
    <div id="dpLjMessages" style="margin-bottom:8px"></div>
  </div>

  <div id="normalizationStepActions" style="text-align:right">
    <button id="computeAllBtn" type="button" data-auto-compute="true" style="display:none" class="compute-btn pill">Compute Plaque</button>
    <button id="continueNormalizationBtn" type="button" style="display:none" class="button pill">Continue Normalization</button>
    <button id="showBcnfTablesBtn" type="button" style="display:none" class="button pill">Show the BCNF Tables</button>
  </div>

  <div id="normalizedOutput"></div>
</div>
<script th:inline="javascript">
  /*<![CDATA[*/
  // Pulling the original FD list and only the transitive ones
  window.fdItems = /*[[${fdItems}]]*/ [];
  window.transitiveFdsArray = /*[[${transitiveFdStrings}]]*/ [];
  // Incoming list for coloring
  window.fdInferred = /*[[${fdInferred}]]*/ [];
  window.alreadyBcnf = /*[[${alreadyBcnf}]]*/ false;
  window.originalNormalForm = /*[[${originalNormalForm}]]*/ '1NF';
  window.currentRelationsNormalForms = /*[[${currentRelationsNormalFormsJson}]]*/ [];
  /*]]>*/
</script>
</body>
</html>